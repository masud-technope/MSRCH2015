thread_ID, Id, ParentId, PostType, Score, CreationDate, OwnerID, Body
50495330,50495330,null,1,0,Wed May 23 18:40:00 EDT 2018,5834346,"<p>I've tried to make this python script run from /etc/rc.local, crontab @reboot, and systemd via systemctl without any success.</p>		<p>The python script runs from the command line while logged in as user pi and exits gracefully into the background without issue. The same goes for running it at the prompt as user pi with: sh /etc/rc.local</p>		<p>Any guidance would be appreciated, as follows:</p>		<pre><code>#!/usr/bin/python		#required libraries	    import sys	    import ssl	    import paho.mqtt.client as mqtt	    import json	    from pprint import pprint	    import Adafruit_CharLCD as LCD	    from textwrap import fill		#Configuration	    rootCAPath = "/home/pi/Cigar-Box/certs/rootCA.pem"	    certFilePath = "/home/pi/Cigar-Box/certs/xxxxxxxxxx-certificate.pem.crt"	    keyFilePath = "/home/pi/Cigar-Box/certs/xxxxxxxxxx-private.pem.key"	    iotThing = "Zorua"	    clientID = "Zorua"		#Device JSON initialization	    device = {'state': {'reported': {'HP':100} } }	    device['state']['reported']['color'] = {'r':0, 'g':0, 'b':0}		#Create LCD	    lcd = LCD.Adafruit_CharLCDPlate()		#LCD wrapper	    def set_lcd_color(R,G,B):	    global lcd	    device['state']['reported']['color']['r'] = R	    device['state']['reported']['color']['g'] = G	    device['state']['reported']['color']['b'] = B	    lcd.set_color(R, G, B)	    def set_lcd_message(message):	    global lcd	    device['state']['reported']['msg'] = message	    lcd.clear()		#Word wrap to fit 16-char wide display and add capitalization	    lcd_message = fill(message.capitalize(),16)	    lcd.message(lcd_message)		# Initialize the LCD using the pins	    set_lcd_message('Initializing...')	    set_lcd_color(0, 0, 1)		#called while client tries to establish connection with the server	    def on_connect(mqttc, obj, flags, rc):	    print "Connecting..."	    if rc==0:	    print ("Subscriber Connection status code: "+str(rc)+" | Connectionstatus: successful")		#We only want to be notified about things we need to change to stay in sync with AWS	    mqttc.subscribe("$aws/things/" + iotThing + "/shadow/update/delta", qos=1)	    elif rc==1:	    print ("Subscriber Connection status code: "+str(rc)+" | Connection status: Connection refused")	    print ("Subscriber Connection status code: "+str(rc))		#called when a topic is successfully subscribed to	    def on_subscribe(mqttc, obj, mid, granted_qos):	    print("Subscribed: "+str(mid)+" "+str(granted_qos)+"data"+str(obj))	    set_lcd_color(0,1,0)	    set_lcd_message('Connected!\nReady for input')		#Let AWS know about the current state of the plate so we can tell us what's     out of sync	    mqttc.publish("$aws/things/" + iotThing + "/shadow/update", json.dumps(device))		#called when a message is received by a topic	#Messages are formatted in JSON	#When working with /update, we might not find all keys all the time, so we need to handle that	    def on_message(mqttc, obj, msg):	    try:	    data = json.loads(msg.payload)	    update = data['state']	    except:	    return		#Look for a message in the update. If it's there, we need to update the display	    if 'msg' in update.keys():	    try:	    set_lcd_message(update['msg'])	    except:	    print("Could not enact message from topic: "+msg.topic+" | QoS: "+str(msg.qos)+" | Data Received: "+str(msg.payload))		#Look to see if the status of R, G, or B has changed for the display	    if 'color' in update.keys():	    try: lcd_r = update['color']['r']	    except: lcd_r = device['state']['reported']['color']['r']	    try: lcd_g = update['color']['g']	    except: lcd_g = device['state']['reported']['color']['g']	    try: lcd_b = update['color']['b']	    except: lcd_b = device['state']['reported']['color']['b']	    set_lcd_color(lcd_r,	                  lcd_g,	                  lcd_b)	#Let AWS know we've updated the display	    mqttc.publish("$aws/things/Zorua/shadow/update", json.dumps(device))		#creating a client with client-id=Zorua	    mqttc = mqtt.Client(client_id=clientID)	    mqttc.on_connect = on_connect	    mqttc.on_reconnect = on_connect	    mqttc.on_subscribe = on_subscribe	    mqttc.on_message = on_message		#Configure network encryption and authentication options. Enables SSL/TLS support.	#adding client-side certificates and enabling tlsv1.2 support as required by aws-iot service	    mqttc.tls_set(rootCAPath,	    certfile=certFilePath,	    keyfile=keyFilePath,	    tls_version=ssl.PROTOCOL_TLSv1_2, ciphers=None)		#connecting to aws-account-specific-iot-endpoint	    print ("About to connect")	    mqttc.connect("lettersandnumbers.iot.us-west-2.amazonaws.com", port=8883) #AWS IoT service hostname and portno		#automatically handles reconnecting	    mqttc.loop_forever()	</code></pre>		<p>The code located in /etc/rc.local followed by a simple redirect test to see if rc.local is behaving</p>		<pre><code># Default code located inside /etc/rc.local	# Print the IP address		    _IP=$(hostname -I) || true	    if [ "$_IP" ]; then	    printf "My IP address is %s\n" "$_IP" &gt; /home/pi/cigarbox.log	    fi	    exit 0		######################################################################			# After rebooting RPi = no output to log	    pi@cigarbox:~ $ cat cigarbox.log		# Running /etc/rc.local from the command line	    pi@cigarbox:~ $ sh /etc/rc.local		# After running /etc/rc.local locally = output to log	    pi@cigarbox:~ $ cat cigarbox.log	    My IP address is 192.168.0.21	</code></pre>		<p>Here are the paths for pi and root</p>		<pre><code># Running as pi        	    pi@cigarbox:~ $ echo $PATH	    /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games		# Running s root 	    pi@cigarbox:~ $ su - root	    Password:	    root@cigarbox:~# echo $PATH	    /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin	</code></pre>		<p>Nice. It looks like rc.local is behaving</p>		<pre><code>     # Cat and pipe of boot.log	     root@cigarbox:~# cat /var/log/boot.log | grep rc.local	     Starting /etc/rc.local Compatibility...	     [  OK  ] Started /etc/rc.local Compatibility.	</code></pre>		<p>However, I've tried this in the past. See line commented out below the python command and path in parenthesis, per suggestion. So, the script still won't run out of /etc/rc.local</p>		<pre><code>#!/bin/sh -e	#	# rc.local	#	# This script is executed at the end of each multiuser runlevel.	# Make sure that the script will "exit 0" on success or any other	# value on error.	#	# In order to enable or disable this script just change the execution	# bits.	#	# By default this script does nothing.		# Print the IP address	#_IP=$(hostname -I) || true	#if [ "$_IP" ]; then	#  printf "My IP address is %s\n" "$_IP" &gt; /home/pi/cigarbox.log	#fi		    (python /home/pi/Cigar-Box/CigarBox.py)&amp;		#/usr/bin/python /home/pi/Cigar-Box/CigarBox.py &gt; /home/pi/cigarbox.log 2&gt;&amp;1 &amp;		    exit 0	</code></pre>		<p>Hmm, it appears that I need 10 good boy points to upload images. I'll have to post the successful completion of this group's most appreciated help. Thank you all..photo URL and solution to follow.</p>		<p>Okay, here's a link to a photo of my voice recognition project that now starts automatically because of the support from my new friends at stackoverflow: </p>		<p><a href="https://drive.google.com/file/d/19ribELmAnQFy4jfzi5D6I7fk91naS8J7/view?usp=drivesdk" rel="nofollow noreferrer">https://drive.google.com/file/d/19ribELmAnQFy4jfzi5D6I7fk91naS8J7/view?usp=drivesdk</a></p>	"
50495330,88003862,50495330,3,0,Wed May 23 18:54:00 EDT 2018,4799172,"You're asking a question about whether it's ok to ask a question? It's fine if you can boil it down to an [MCVE](https://stackoverflow.com/help/mcve) but from your post it sounds like it might be quite broad."
50495330,88052758,50495330,3,0,Fri May 25 01:06:00 EDT 2018,4902099,"If you can run the script in command line, but not in other ways, it probably relate to the way you set it up or file permission or running path issues. You provide no information on how you setup to run via /etc/rc.local, or crontab."
50495330,88052980,50495330,3,0,Fri May 25 01:27:00 EDT 2018,5834346,"Thank you for pointing that out. My bad. I'm just getting use to the 5 minute limit for answering. This is a very interesting world you folks live in. Vry-very interesting. Now I have to figure out how to post more code. I appreciate your patience."
50495330,88053042,50495330,3,0,Fri May 25 01:33:00 EDT 2018,5834346,"@BlackVegetable  Here's the result of your suggestion. It looks like /etc/rc.local is misbehaving. What would you suggest?"
50495330,88053306,50495330,3,0,Fri May 25 01:58:00 EDT 2018,5834346,"I hope that I'm not hacking-up the code formatting too much. I really need to look at the way this works. Thanks again."
50495330,88053946,50495330,3,0,Fri May 25 02:57:00 EDT 2018,4902099,"what do you see in `/var/log/boot.log`? Also you can try to use crontab instead of rc.local to do the job by run `sudo crontab -e` and add the command `@reboot /usr/bin/python /home/pi/Cigar-Box/CigarBox.py`."
50495330,88054028,50495330,3,0,Fri May 25 03:02:00 EDT 2018,4902099,"Also try to use the multiple commands that I suggested with `sleep 10;`, this allows the system to continue to boot and only execute the python command 10 seconds later, as some of the services that your script depend on may not available yet at the time of rc.local is run."
50495330,88043048,50495330,3,0,Thu May 24 17:46:00 EDT 2018,5834346,"-BlackVegetable  That's a good place to start. Will do tonight, but my /home/pi/cigarbox.log captures the last comment in the script, "About to connect" when I remove the job command to put it in the background, e.g.  &.  So, I'm thinking that it runs and something gets messed up with what's returned by MQTT.  Is there a way to execute the script using /etc/rc.local and then wait 10 seconds before putting it in the background and  thereby fending off the the last line in rc.local which does an exit 0.....which may be blocking the return from MQTT? Anyway, back to the basics tonight. Thanks!"
50495330,88053403,50495330,3,0,Fri May 25 02:08:00 EDT 2018,4902099,"1) you have no customise code in rc.local to run your script. 2) rc.local does get run upon boot, it just not log to your log file, check `/var/log/boot.log`, you will see the log about IP address upon boot."
50495330,88053475,50495330,3,0,Fri May 25 02:14:00 EDT 2018,4902099,"3) to run python script on rc.local, you need to add `(python /yourpath/script.py)&` into the end of `/etc/rc.local` file, btw, anything in rc.local will run as root, so you don't need sudo."
50495330,88053539,50495330,3,0,Fri May 25 02:20:00 EDT 2018,5834346,"@ hcheung  Got it. Thank you very much."
50495330,88053552,50495330,3,0,Fri May 25 02:21:00 EDT 2018,5834346,"What do the parenthesis do?"
50495330,88053567,50495330,3,0,Fri May 25 02:22:00 EDT 2018,4902099,"parentheses allows your to run multiple commands in one line, like `(sleep 10; python script.py)&`."
50495330,88053742,50495330,3,0,Fri May 25 02:42:00 EDT 2018,5834346,"@hcheung   Bummer. It still doesn't run on reboot. Take a look at my latest cut and paste code section. Nice to meet you! Hopefully we can talk some more tomorrow night. Signing off for now."
50495330,88010182,50495330,3,0,Wed May 23 23:10:00 EDT 2018,5834346,"Okay guys, here's the nuts & bolts."
50495330,88034425,50495330,3,0,Thu May 24 13:50:00 EDT 2018,758446,"Can you swap out this script with a "hello world" kind of program and try to run it via any such method? Let's rule out the script being the problem first."
50495330,50520948,50495330,2,1,Fri May 25 03:10:00 EDT 2018,4902099,"<h2>To run python script via <code>/etc/rc.local</code>:</h2>		<p>1) Edit the file using <code>sudo /etc/rc.local</code>;</p>		<p>2) Add the following to the file right before <code>exit 0</code>:</p>		<pre><code>(sleep 10;python /home/pi/Cigar-Box/CigarBox.py)&amp;	</code></pre>		<p>The parentheses allows your to run multiple commands in the background. The <code>sleep 10</code> will delay the running of script by 10 seconds, as some of the services that your script depend on may not be available yet at the time of booting rc.local.</p>		<p>Alternatively you can use crontab @reboot to automate the execution of your script.</p>		<h2>Using crontab:</h2>		<p>1) run command line <code>sudo crontab -e</code>;</p>		<p>2) add the command to the end of the file:</p>		<pre><code>@reboot /usr/bin/python /home/pi/Cigar-Box/CigarBox.py	</code></pre>	"
50495330,88070501,50520948,3,0,Fri May 25 12:39:00 EDT 2018,5834346,"Success!!! You analysis of the problem is spot on. Thank you so very much for your guidance and patience. My deepest appreciation. Please take a moment to look at my voice recognition project: https://drive.google.com/file/d/19ribELmAnQFy4jfzi5D6I7fk91naS8J7/view?usp=drivesdk"
50495330,88070613,50520948,3,0,Fri May 25 12:41:00 EDT 2018,4902099,"Glad it works out for you. If this answer help you solve the problem. Please upvote it. BTW, that's looks like a cool machine."
50495330,88070660,50520948,3,0,Fri May 25 12:43:00 EDT 2018,5834346,"...almost forgot, the solution was using a sleep 10 in /etc/rc.local per your one liner: (sleep 10;python /home/pi/Cigar-Box/CigarBox.py)&"
50495330,88070698,50520948,3,0,Fri May 25 12:44:00 EDT 2018,5834346,"Thanks for the compliment. How do I upvote?"
50495330,88070794,50520948,3,0,Fri May 25 12:46:00 EDT 2018,4902099,"Click on the 'up' arrow or the 'tick' on the upper left of this post."
50495330,88071115,50520948,3,0,Fri May 25 12:55:00 EDT 2018,5834346,"Got it, but my vote is rather weak at this point, as the response was:  Thanks for the feedback! Votes cast by those with less than 15 reputation are recorded, but do not change the publicly displayed post score."
50495330,88071182,50520948,3,0,Fri May 25 12:56:00 EDT 2018,5834346,"Hence, my 2x gratitude for your help, my friend."
50495330,88071205,50520948,3,0,Fri May 25 12:57:00 EDT 2018,4902099,"I think you should click the 'tick' sign but if you can't do. Don't worry about it."
50495330,88071306,50520948,3,0,Fri May 25 13:00:00 EDT 2018,4902099,"https://stackoverflow.com/help/someone-answers"
50495330,88119101,50520948,3,0,Sun May 27 16:28:00 EDT 2018,5834346,"There we go. The up-vote check mark turned green when I clicked on it this time. Thanks again!"
50495330,88067656,50520948,3,0,Fri May 25 11:24:00 EDT 2018,5834346,"I've tried to make this python script run from /etc/rc.lI've tried to make this python script run from /etc/rc.local, crontab, and systemd via systemctl without any success.ocal, crontab @reboot, and systemd via systemctl without any success. I've also considered using a delay, but I'm thinking that the script needs to start and then have a delay before putting it in the background. Do you know how to do this? Meanwhile I will try the sleep 10 and get back to you. Thanks."
