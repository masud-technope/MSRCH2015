thread_ID, Id, ParentId, PostType, Score, CreationDate, OwnerID, Body
45010487,45010487,null,1,4,Mon Jul 10 11:09:00 EDT 2017,1489790,"<p>I am integrating the JITR by follwing this article.</p>		<p><a href="https://aws.amazon.com/blogs/iot/just-in-time-registration-of-device-certificates-on-aws-iot/" rel="nofollow noreferrer">https://aws.amazon.com/blogs/iot/just-in-time-registration-of-device-certificates-on-aws-iot/</a></p>		<p>I am done with all these steps and able to authenticate the certificate through command-line 'mosquitto_pub'.</p>		<p>First time when I run 'mosquitto_pub' command it calls lambda function to authorize it and attach policy and second time it publish message to IOT successfully.</p>		<p>Here is command that I am using.</p>		<pre><code>mosquitto_pub --cafile ../root.cert --cert hassanAndCACert.crt --key hassan.key -h &lt;###&gt;.iot.us-east-1.amazonaws.com	-p 8883 -q 1 -t  topic5 -i  123456789 --tls-version tlsv1.2 -m '{"hello":"3"}' -d	</code></pre>		<p>But when I try to authenticate this in android SDK I am getting 'handshake' fail error. Here is exception that I am getting.</p>		<blockquote>	  <p>MqttException (0) - javax.net.ssl.SSLHandshakeException: Handshake	  failedat	  org.eclipse.paho.client.mqttv3.internal.ExceptionHelper.createMqttException(ExceptionHelper.java:38)at	  org.eclipse.paho.client.mqttv3.internal.ClientComms$ConnectBG.run(ClientComms.java:664)at	  java.lang.Thread.run(Thread.java:818)Caused by:	  javax.net.ssl.SSLHandshakeException: Handshake failedat	  com.android.org.conscrypt.OpenSSLSocketImpl.startHandshake(OpenSSLSocketImpl.java:441)at	  org.eclipse.paho.client.mqttv3.internal.SSLNetworkModule.start(SSLNetworkModule.java:93)at	  org.eclipse.paho.client.mqttv3.internal.ClientComms$ConnectBG.run(ClientComms.java:650)	  ... 1 moreCaused by: javax.net.ssl.SSLProtocolException: SSL handshake	  terminated: ssl=0xb91e9b40: Failure in SSL library, usually a protocol	  errorerror:100c5416:SSL	  routines:ssl3_read_bytes:SSLV3_ALERT_CERTIFICATE_UNKNOWN	  (external/boringssl/src/ssl/s3_pkt.c:972 0xb9215530:0x00000001)at	  com.android.org.conscrypt.NativeCrypto.SSL_do_handshake(Native	  Method)at	  com.android.org.conscrypt.OpenSSLSocketImpl.startHandshake(OpenSSLSocketImpl.java:353)</p>	</blockquote>		<p>Interestingly  if device-certificate is already active and we try to publish message through android it get published successfully. The only problem is to authenticate the certificate at first call. If my code is faulty it should not send message against activated-certificates.</p>		<p>The difference that I see between mosquitto call and the android-code is that mosquitto is making a single command to connect and publish the message, where as PAHO-MQTT in AWS SDK needs to connect first before publishing, and I get exception in 'connect'. I even did not get any logs in AWS logs.</p>	"
45010487,45075363,45010487,2,1,Thu Jul 13 08:30:00 EDT 2017,5157221,"<h3>Possible Reasons</h3>		<p>SSL/TLS Handshake can fail for various reasons and not only for certificate validation problems.</p>		<p>It could be for:</p>		<ul>	<li>Not sharing same cipher suites</li>	<li>Not sharing SSL versions</li>	<li>Certificate validation</li>	<li>Intent to change TLS version</li>	<li>Others issues</li>	</ul>		<p>The best way to figure out what your problem is is to install <a href="https://www.wireshark.org/" rel="nofollow noreferrer">Wireshark</a> and see the handshake messages. Then based on the SSL alert message sent from server to client you can have more information on the SSL handshake failure, where specifically it happened.</p>		<h3>Possible solution</h3>		<ul>	<li><em>Solution No. 1:</em> This link might also help: <a href="https://stackoverflow.com/questions/6353849/received-fatal-alert-handshake-failure-through-sslhandshakeexception">Received fatal alert: handshake_failure through SSLHandshakeException</a></li>	<li><em>Solution No. 2:</em> Could you try to upgrade the keystore for your Android App?</li>	</ul>		<h3>Helpful resources</h3>		<ul>	<li><a href="https://serverfault.com/questions/639837/openssl-s-client-shows-alert-certificate-unknown-but-all-server-certificates-app#639866">https://serverfault.com/questions/639837/openssl-s-client-shows-alert-certificate-unknown-but-all-server-certificates-app#639866</a></li>	<li><a href="https://aws.amazon.com/de/blogs/iot/just-in-time-registration-of-device-certificates-on-aws-iot/" rel="nofollow noreferrer">https://aws.amazon.com/de/blogs/iot/just-in-time-registration-of-device-certificates-on-aws-iot/</a></li>	<li><a href="https://aws.amazon.com/de/blogs/mobile/use-your-own-certificate-with-aws-iot/" rel="nofollow noreferrer">https://aws.amazon.com/de/blogs/mobile/use-your-own-certificate-with-aws-iot/</a></li>	<li><a href="https://stackoverflow.com/a/6353956/5157221">https://stackoverflow.com/a/6353956/5157221</a></li>	</ul>	"
