thread_ID, Id, ParentId, PostType, Score, CreationDate, OwnerID, Body
50531852,50531852,null,1,1,Fri May 25 14:47:00 EDT 2018,1793353,"<p>I setup azure, created iot hub, device, topic and subscription.	Now I want to send a message from a python script via mqtt and see it appear somehow on the azure page</p>		<pre><code>def on_connect(client, userdata, flags, rc):	  print ("Device connected with result code: " + str(rc))	def on_disconnect(client, userdata, rc):	  print ("Device disconnected with result code: " + str(rc))	def on_publish(client, userdata, mid):	  print ("Device sent message")		client = mqtt.Client(client_id=device_id, protocol=mqtt.MQTTv311)		client.on_connect = on_connect	client.on_disconnect = on_disconnect	client.on_publish = on_publish		client.username_pw_set(username=iot_hub_name+".azure-devices.net/" + device_id, password=sas_token)		client.tls_set(certfile=None, keyfile=None, cert_reqs=ssl.CERT_REQUIRED, tls_version=ssl.PROTOCOL_TLSv1, ciphers=None)	client.tls_insecure_set(False)		client.connect(iot_hub_name+".azure-devices.net", port=8883)		client.publish("devices/" + device_id + "/messages/events/", "{id=123}", qos=1)	client.loop_forever()	</code></pre>		<p>The problem is that I don't know how to specify the topic.	When I tried this</p>		<pre><code>client.publish("devices/" + device_id + "/mytopicname/messages", "{id=123}", qos=1)	</code></pre>		<p>it disconnects with code 1.</p>	"
50531852,50532934,50531852,2,0,Fri May 25 15:53:00 EDT 2018,4841665,"<p>Code 1 means that you are using different protocol version. Newest version sometime has different header (for example added an additional field).</p>		<p>Exact meaning of code 1: " Connection Refused, unacceptable protocol version"</p>	"
50531852,88081171,50532934,3,0,Fri May 25 17:57:00 EDT 2018,1793353,"Ok, how about sending to topic?"
50531852,88081461,50532934,3,0,Fri May 25 18:09:00 EDT 2018,4841665,"Code 1 you are mentioned in question regards to connection, not to publishing ("4.3 Payload	The PUBACK Packet has no payload."). It is not possible to publish when client is not connected. The other possibility is that you are exceeding keep alive time"
50531852,88121913,50532934,3,0,Sun May 27 19:06:00 EDT 2018,4841665,"Have you tried with simpler topic name? For example "client.publish("devices/test")? Can you should body of "publish" function?"
50531852,88085928,50532934,3,0,Fri May 25 21:14:00 EDT 2018,1793353,"If I do not change the code, it connects with code 0. And a message seems to be send. But how to specify a topic?"
50531852,50560954,50531852,2,2,Mon May 28 07:12:00 EDT 2018,8546089,"<p>IoT Hub is not a general-purpose pub-sub messaging broker, it only supports the documented topic names and topic filters. Please refer to this document(<a href="https://docs.microsoft.com/en-us/azure/iot-hub/iot-hub-mqtt-support#using-the-mqtt-protocol-directly" rel="nofollow noreferrer">Communicate with your IoT hub using the MQTT protocol</a>).</p>		<p>So you can not publish a custom topic when you want to connect to IoT Hub with MQTT directly.</p>	"
50531852,88152683,50560954,3,0,Mon May 28 18:00:00 EDT 2018,1793353,"How should I do that then? According to the documentation it seemed to be possible to me 	_Sending device-to-cloud messages	After making a successful connection, a device can send messages to IoT Hub using devices/{device_id}/messages/events/ or devices/{device_id}/messages/events/{property_bag} as a Topic Name. The {property_bag} element enables the device to send messages with additional properties in a url-encoded format._"
50531852,88163278,50560954,3,0,Tue May 29 05:48:00 EDT 2018,8546089,"I think you can choose [Azure Service Bus](https://docs.microsoft.com/en-us/azure/service-bus-messaging/service-bus-messaging-overview) instead of IoT Hub.You can also use topics to send and receive messages.Topics can have multiple, independent subscriptions.You can refer to this document about [How to use Service Bus queues with Python](https://docs.microsoft.com/en-us/azure/service-bus-messaging/service-bus-python-how-to-use-queues)."
