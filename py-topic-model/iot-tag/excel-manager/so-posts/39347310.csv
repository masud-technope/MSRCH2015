thread_ID, Id, ParentId, PostType, Score, CreationDate, OwnerID, Body
39347310,39347310,null,1,1,Tue Sep 06 10:56:00 EDT 2016,6799537,"<p>I am trying to write a query in ASA (Azure Stream Analytics) where the input is a json line message that looks like this</p>		<pre><code>{	    "DeviceId": "Device3",	    "DateTime": "2016-09-05T13:23:04.5444423",	    "Value": [ 1, 0, 1, 0, 0, 1, 0 ]	}	</code></pre>		<p>And what I want to do is to perform an Unpivot so the data comes on the form </p>		<pre><code>create table LightBeacon (	     DeviceId int primary key not null,	     EventDateTime datetime not null,	     LightBeaconId varchar(25) not null,	     LightBeaconState SmallInt not null	)	</code></pre>		<p>But seems that ASA do not support the SQL Unpivot function and is there by left with multi select statements like</p>		<pre><code>with 	    DataUnArray as (    	        SELECT DeviceId, DateTime as EventDateTime	            , GetArrayElement(Value, 0) as LigthBeacon01	            , GetArrayElement(Value, 1) as LigthBeacon02	            , GetArrayElement(Value, 2) as LigthBeacon03	            , GetArrayElement(Value, 3) as LigthBeacon04	            , GetArrayElement(Value, 4) as LigthBeacon05	            , GetArrayElement(Value, 5) as LigthBeacon06	            , GetArrayElement(Value, 6) as LigthBeacon07	        FROM DataIoT	        where DeviceId = 'Device3'),	    DataUnpivot as (	            select DeviceId, EventDateTime, 'LigthBeacon01' as LigthBeaconId, LigthBeacon01 as LigthBeaconState from DataUnArray	        Union All select DeviceId, EventDateTime, 'LigthBeacon02' as LigthBeaconId, LigthBeacon02 as LigthBeaconState from DataUnArray	        Union All select DeviceId, EventDateTime, 'LigthBeacon03' as LigthBeaconId, LigthBeacon03 as LigthBeaconState from DataUnArray	        Union All select DeviceId, EventDateTime, 'LigthBeacon04' as LigthBeaconId, LigthBeacon04 as LigthBeaconState from DataUnArray	        Union All select DeviceId, EventDateTime, 'LigthBeacon05' as LigthBeaconId, LigthBeacon05 as LigthBeaconState from DataUnArray	        Union All select DeviceId, EventDateTime, 'LigthBeacon06' as LigthBeaconId, LigthBeacon06 as LigthBeaconState from DataUnArray	        Union All select DeviceId, EventDateTime, 'LigthBeacon07' as LigthBeaconId, LigthBeacon07 as LigthBeaconState from DataUnArray	    )   	    select DeviceId, EventDateTime, LigthBeaconId, LigthBeaconState	    into DataLakeCSV	    from DataUnpivot	</code></pre>		<p>The ASA Query is failing to start with the following error:</p>		<blockquote>	  <p>Stream Analytics job has validation errors: Job will exceed the	  maximum amount of Event Hub Receivers</p>	</blockquote>		<p>If I reduce it to 5 beacon – it works!!! So how can I write a ASA Query that can handle more than 5 columns in an unpivot?</p>		<p>\Bjørn</p>	"
39347310,39380363,39347310,2,1,Wed Sep 07 23:18:00 EDT 2016,4573221,"<p>UNPIVOT is unsupported, but you can achieve the same results with CROSS APPLY and GetRecordProperties function:</p>		<pre><code>WITH DataUnArray	AS (	    SELECT DeviceId	        ,DATETIME AS EventDateTime	        ,GetArrayElement(Value, 0) AS LigthBeacon01	        ,GetArrayElement(Value, 1) AS LigthBeacon02	        ,GetArrayElement(Value, 2) AS LigthBeacon03	        ,GetArrayElement(Value, 3) AS LigthBeacon04	        ,GetArrayElement(Value, 4) AS LigthBeacon05	        ,GetArrayElement(Value, 5) AS LigthBeacon06	        ,GetArrayElement(Value, 6) AS LigthBeacon07	    FROM DataIoT	    WHERE DeviceId = 'Device3'	    )		SELECT    	     event.DeviceId	    ,event.EventDateTime	    ,p.PropertyName AS LigthBeaconId,	     p.PropertyValue AS LigthBeaconState	 FROM DataUnArray event	 CROSS APPLY GetRecordProperties(event) p	 WHERE p.PropertyName LIKE 'ligthbeacon%'	</code></pre>	"
39347310,66227115,39380363,3,0,Mon Sep 12 14:37:00 EDT 2016,6799537,"It Works - perfect. 	I did a rewrite of the code using GetArrayElements - which made it simple and even more powerfull."
