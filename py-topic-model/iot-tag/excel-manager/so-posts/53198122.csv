thread_ID, Id, ParentId, PostType, Score, CreationDate, OwnerID, Body
53198122,53198122,null,1,1,Wed Nov 07 21:30:00 EST 2018,10619766,"<p>I am writing a program connecting a web service in PHP to an MQTT broker. The broker is running mosquitto on a Raspberry Pi.</p>		<p>The idea is to have the web service send a request (a form is submitted) and then send a publish to the MQTT broker and then wait for a reply.</p>		<p>However, the problem is that the loop seems to cause a PHP fatal error due to the fact that it is an endless loop. </p>		<p>I've tried adding the quitstop() function to quit the loop after a message is recieved, but the program crashes before it reaches that point.</p>		<p>MQTT is still very new to me, but I need to send the request and then keep the loop open until I recieve the answer in order to proceed with my program.</p>		<p>This is the code to handle the form submit: </p>		<pre><code>require("phpMQTT.php");		$server = "xxx.xxx.xxx.xx";              // change if necessary	$port = 1883;                       // change if necessary	$username = "username";             // set your username	$password = "password";             // set your password	$client_id = "phpMQTT-request-1234";     // make sure this is unique for connecting to sever - you could use uniqid()		$mqtt = new phpMQTT($server, $port, $client_id);		$msg = $_POST['box'];	if (!empty($msg)) {	    if ($mqtt-&gt;connect(true, null, $username, $password)) {	        $mqtt-&gt;publish("dev/test", $msg, 0);	        $mqtt-&gt;close();	    }	    subscribeToTopic($mqtt);	}		function subscribeToTopic($mqtt)	{	    $topics['dev/test'] = array("qos" =&gt; 0, "function" =&gt; "procmsg");	    $mqtt-&gt;subscribe($topics, 0);	    while ($mqtt-&gt;proc()) {		    }	    $mqtt-&gt;close();		}	function procmsg($topic, $msg)	{	    global $mqtt;	    echo $msg;	    quitstop($mqtt);	}		function quitstop($mqtt)	{	    $mqtt-&gt;close();	}	</code></pre>	"
