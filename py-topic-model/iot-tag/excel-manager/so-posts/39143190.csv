thread_ID, Id, ParentId, PostType, Score, CreationDate, OwnerID, Body
39143190,39143190,null,1,0,Thu Aug 25 10:45:00 EDT 2016,6756671,"<p>I have deployed the Bluemix GeoSpatial starter application in Bluemix. </p>		<p>It works fine until I want to connect to the Watson IoT Platform instead of the demo MQTT server.</p>		<p>I changed <code>mqtt1.m2m4connectedlife.com</code> to <code>dzqml6.messaging.internetofthings.ibmcloud.com</code> and added <code>mqtt_uid</code> and <code>mqtt_pw</code> to the start parameters jsonObject.</p>		<p>I created an API key in the Watson IoT Platform Dashboard and used these values for <code>mqtt_uid</code> and <code>mqtt_pw</code>.</p>		<p>Then I get an "Error: Connection refused: Not authorized" in the log when starting the application.</p>		<p>Then I also tried the apiKey and apiToken form the Watson IoT Platform environment variables for <code>mqtt_uid</code> and <code>mqtt_pw</code> but still got the same error.</p>		<p>I also tried different values for clientid and notify/input topics but without success.</p>		<p>I read a couple of other posts with similar errors that were resolved after some time because of a delay between when an organization is created and is distributed to all servers.</p>		<p><a href="https://developer.ibm.com/answers/questions/163862/iot-cloud-error-not-authorized.html" rel="nofollow noreferrer">https://developer.ibm.com/answers/questions/163862/iot-cloud-error-not-authorized.html</a></p>		<p>So I waited a day but still have the same error.</p>		<p>I also added myself as a permanent member to the organization as suggested in this post: <a href="https://stackoverflow.com/questions/33309617/refused-not-authorized-error-occurs-with-ibm-iot-foundation-on-bluemix">Refused: not authorized error occurs with IBM IoT Foundation on Bluemix</a></p>		<p>I would be very gratefull for any assistance on this!</p>	"
39143190,39166007,39143190,2,0,Fri Aug 26 12:09:00 EDT 2016,4454969,"<p>When you make an MQTT connection by using an API key, ensure that the following points apply:</p>		<pre><code>The MQTT client ID is in the format: a:orgId:appId	The MQTT user name is the API key: such as a-orgId-a84ps90Ajs	The MQTT password is the authentication token: such as MP$08VKz!8rXwnR-Q*	</code></pre>		<p>See the <a href="https://new-console.ng.bluemix.net/docs/services/IoT/applications/mqtt.html" rel="nofollow">documentation</a> for more details.  If you still experience errors, let us know your 6 character org ID for the IoT service and we can check logs to troubleshoot why you are getting authorization error.  </p>	"
39143190,65680867,39166007,3,0,Fri Aug 26 14:58:00 EDT 2016,4454969,"The authorization errors I see are when you are trying to use connect using "joinhangout"  - is that your geospatial app?"
39143190,65676680,39166007,3,0,Fri Aug 26 13:14:00 EDT 2016,6756671,"Thank you Valerie.	I use the proper client ID but still the same error.	My org id is dzqml6. Hope you find something in the logs!"
39143190,65678689,39166007,3,0,Fri Aug 26 14:03:00 EDT 2016,4454969,"I see errors for API Key auth () failed (API key does not exist):  are you sure you were using the correct API key?  I see more recently that you are connecting with a different API key that seems to be working."
39143190,65679111,39166007,3,0,Fri Aug 26 14:14:00 EDT 2016,6756671,"Yes I created a new API key to try if that resolves the problem but still have the same error. I was trying again a few times in the last hour but still the same error. Earlier I also tried the API key/token from the environment variables and I guess that is what you see in the log.		It looks like the Geospatial service on Bluemix has it's own way of connecting to the MQTT server:		client = mqtt.createClient(1883,"dzqml6.messaging.internetofthings.ibmcloud.com", { "clientId": 'a:dzqml6:joinhangout'} );"
39143190,65679147,39166007,3,0,Fri Aug 26 14:15:00 EDT 2016,6756671,"jsonObject = JSON.stringify({	  			"mqtt_uid" : "API key",			"mqtt_pw" : "API token",	        "mqtt_uri" :  "dzqml6.messaging.internetofthings.ibmcloud.com:1883",	        "mqtt_input_topics" : "iot-2/evt/#",	        "mqtt_notify_topic" : notify_topic_string,	        "device_id_attr_name" : "ID",	        "latitude_attr_name" : "lat",	        "longitude_attr_name" : "lon"	      });"
39143190,65681049,39166007,3,0,Fri Aug 26 15:02:00 EDT 2016,6756671,"Yes joinhangout is my geospatial app in Bluemix. I also use 'joinhangout' as the appId. I did not register the app/appId anywhere else. Just use it in the code for clientId: 'a:dzqml6:joinhangout'"
39143190,65681156,39166007,3,0,Fri Aug 26 15:05:00 EDT 2016,4454969,"For your jsonObject, can you confirm the JSON.stringify "API key" being passed is a valid API key?   Also, what is the value for , "mqtt_notify_topic" ?"
39143190,65681324,39166007,3,0,Fri Aug 26 15:09:00 EDT 2016,4454969,"It appears you are using topics that should be used when you are connecting as a device rather than an application - see doc about publishing and subscribing as an application . Subscribe to topic iot-2/type/device_type/id/device_id/evt/event_id/fmt/format_string  https://new-console.ng.bluemix.net/docs/services/IoT/applications/mqtt.html"
39143190,65681484,39166007,3,0,Fri Aug 26 15:13:00 EDT 2016,6756671,"Yes, I use the API Key and token I created in the Watson IoT Platform dashboard where it says API Key. I just replaced these in my reply.  I tried different values for mqtt_notify_topic but the latest one I used is 'joinhangout/events'"
39143190,65681891,39166007,3,0,Fri Aug 26 15:24:00 EDT 2016,4454969,"I do not think that topic string is valid.   I will ask someone from geospatial to take a look at this post."
39143190,65682103,39166007,3,0,Fri Aug 26 15:30:00 EDT 2016,6756671,"Thank you Valerie. I now tried 'iot-2/type/Android/id/12345678/evt/update/fmt/json' and 'iot-2/type/Android/id/*' but still the same error."
39143190,39170195,39143190,2,2,Fri Aug 26 15:51:00 EDT 2016,5749411,"<p>There's a part of the Node.js code in the starter app that directly subscribes to the notify topic.  Is the auth error coming from that subscription attempt?  If so, did you modify that part of the code to pass credentials?</p>		<p>Here are the lines of code in the app.js that I'm referring to.</p>		<pre><code>var clientId = 'geo-quickstart:' + port;	//create the MQTT client and subscribe	client = mqtt.createClient(1883,"mqtt1.m2m4connectedlife.com", { "clientId": clientId } );	console.log("Subscribing to topic: " + notify_topic_string + "\n");	client.subscribe(notify_topic_string);	</code></pre>		<p>If you aren't passing the credentials on the createClient call, try adding a parameter {username: "user", password: "pass"} to the list of arguments.</p>	"
39143190,65683648,39170195,3,0,Fri Aug 26 16:16:00 EDT 2016,6756671,"Thank you very much Mike, that was it! After adding username and password to the createClient call it worked!"
