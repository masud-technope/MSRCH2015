thread_ID, Id, ParentId, PostType, Score, CreationDate, OwnerID, Body
53501658,53501658,null,1,1,Tue Nov 27 14:14:00 EST 2018,5031428,"<p>I'am working with kind of IoT device. Finaly I've got simple httpd server to work, and simple html pages works like a charm, but browser does not recognise images. I think this is http header issue, but i do not know what is exacly wrong.</p>		<p>For example, my test page look like this:</p>		<pre><code>&lt;html&gt;	&lt;head&gt;&lt;title&gt;test page&lt;/title&gt;&lt;/head&gt;	&lt;body&gt;	hello world!	&lt;img src="img.png"&gt;	&lt;/body&gt;	&lt;/html&gt;	</code></pre>		<p>If i go to <a href="http://de.vi.ce.ip/" rel="nofollow noreferrer">http://de.vi.ce.ip/</a> 2 reqests are generated:</p>		<pre><code>GET / HTTP/1.1\r\n	Accept text/html, application/xhtml+xml, */*\r\n	Accept-Language: en-EN\r\n	...		GET /img.png HTTP/1.1\r\n	Accept image/png, image/svg+xml, image/*;q=0.8, */*;q=0.5\r\n	Accept-Language: en-EN\r\n	...	</code></pre>		<p>To witch my server responds with:</p>		<pre><code>HTTP/1.0 200 OK\r\n	Content-Type: text/html\r\n	Content-Length: 131\r\n	\r\n	&lt;page data&gt;		HTTP/1.0 200 OK\r\n	Content-Type: image/png\r\n	Content-Length: 5627\r\n	\r\n	&lt;image binary data&gt;	</code></pre>		<p>As the result i can see the text, but images are broken.	I've tryed few more parameters like <code>Connection: close, Accept-Ranges: bytes, Content-Location (path)</code>.	I've tryed jpeg image under <code>Content-Type: image/jpeg</code> with no luck. I'am certain that image sent correctly.</p>	"
53501658,93872679,53501658,3,0,Tue Nov 27 14:22:00 EST 2018,6139796,"You have to send the correct `Content-Type`. i.e. image/jpeg"
53501658,93872859,53501658,3,0,Tue Nov 27 14:27:00 EST 2018,5031428,"@Holger I did. It is typo in my question, sorry. And it is image/png in my case."
53501658,93873064,53501658,3,0,Tue Nov 27 14:32:00 EST 2018,6139796,"I think you read the png from file. Do you open the file in binary mode?"
53501658,93873236,53501658,3,0,Tue Nov 27 14:36:00 EST 2018,5031428,"@Holger Yes. I've check output buffer, before send it to tcp and it is correct. Binary content looks as it should."
53501658,53501850,53501658,2,0,Tue Nov 27 14:24:00 EST 2018,1813336,"<p>The request is asking for <code>png</code></p>		<pre><code>GET /img.png HTTP/1.1\r\n	</code></pre>		<p>Why not return the correct content type;</p>		<pre><code>Content-Type: image/png\r\n	</code></pre>	"
53501658,93872943,53501850,3,0,Tue Nov 27 14:29:00 EST 2018,5031428,"Sorry it was typo in question. I am sending correct content-type image/png for png or image/jpeg for jpg."
53501658,53502558,53501658,2,0,Tue Nov 27 15:07:00 EST 2018,10524386,"<p>I've made exactly the same - raw http server for IoT and your response looks absolutely correct. Try check following:</p>		<ul>	<li><p>You correctly flush the socket before closing it. If you call <code>close()</code> right after send(), you will likely encounter this problem - data has not been correctly written</p></li>	<li><p>The Content-Length should be exactly the size of your file. Make sure you are not counting \r\n bytes of http response. Browser may still wait for tail bytes</p></li>	<li><p>Finally, get the browser network logs :)</p></li>	</ul>	"
53501658,93899959,53502558,3,0,Wed Nov 28 08:56:00 EST 2018,5031428,"Turns out it was memory problem. The tcp_write function returned -1 witch is memory error. I use lwip and it is based on it's own wierd alloc functions. I've just increased buffer sizes and it worked. There is no flush function, but there is tcp_output function, witch forces sending data, but it did not help. Also i've tryed to write data in chunks, but result was the same."
