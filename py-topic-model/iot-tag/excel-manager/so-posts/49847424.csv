thread_ID, Id, ParentId, PostType, Score, CreationDate, OwnerID, Body
49847424,49847424,null,1,2,Sun Apr 15 22:32:00 EDT 2018,1308777,"<p>I setup an IoT hub on Azure, and created a device called "ServerTemp".  I generated an SAS token, and it seems to be accepted (I don't get 401).  But I'm getting a 400 Bad Request.  </p>		<p>Here is the request I'm sending via curl:</p>		<p><code>curl -v -H"Authorization:SharedAccessSignature sr=A794683.azure-devices.net&amp;sig=&lt;snip&gt;" -H"Content-Type:application/json" -d'{"deviceId":"ServerTemp","temperature":70}' https://A479683.azure-devices.net/devices/ServerTemp/messages/events?api-version=2016-11-14</code></p>		<p>Request and Response (output from curl):</p>		<pre><code>&gt; POST /devices/ServerTemp/messages/events?api-version=2016-11-14 HTTP/1.1	&gt; Host: A479683.azure-devices.net	&gt; User-Agent: curl/7.47.0	&gt; Accept: */*	&gt; Authorization:SharedAccessSignature sr=A794683.azure-devices.net&amp;sig=&lt;snip&gt;	&gt; Content-Type:application/json	&gt; Content-Length: 42	&gt;	* upload completely sent off: 42 out of 42 bytes	&lt; HTTP/1.1 400 Bad Request	&lt; Content-Length: 151	&lt; Content-Type: application/json; charset=utf-8	&lt; Server: Microsoft-HTTPAPI/2.0	&lt; iothub-errorcode: ArgumentInvalid	&lt; Date: Sun, 15 Apr 2018 22:21:50 GMT	&lt;	* Connection #0 to host A479683.azure-devices.net left intact	{"Message":"ErrorCode:ArgumentInvalid;BadRequest","ExceptionMessage":"Tracking ID:963189cb515345e69f94300655d3ca23-G:10-TimeStamp:04/15/2018 22:21:50"}	</code></pre>		<p>What am I doing wrong?</p>	"
49847424,49847981,49847424,2,1,Mon Apr 16 00:03:00 EDT 2018,4148708,"<p>Make sure you add the expiry time <code>&amp;se=</code> (as in <code>&amp;se=1555372034</code>) when you form the SAS. It should be the very last parameter. That's the only way i can reproduce the HTTP 400 you're seeing (by omitting it). You should get a <code>204 No Content</code> once you fix that.</p>		<p>The resource (<code>&amp;sr=</code>) part also seems a bit off in your case, there's no device being specified. Use <a href="https://github.com/Azure/azure-iot-sdk-csharp/releases/tag/2018-3-13" rel="nofollow noreferrer">Device Explorer</a> to generate a <em>device</em> SAS (or just to see how it should look like): <em>Management > SAS Token</em>.</p>		<p><a href="https://docs.microsoft.com/en-us/azure/iot-hub/iot-hub-devguide-security#security-token-structure" rel="nofollow noreferrer">SAS structure</a> &mdash;<br>	<code>SharedAccessSignature sig={signature-string}&amp;se={expiry}&amp;skn={policyName}&amp;sr={URL-encoded-resourceURI}</code></p>		<pre><code>$ curl -i https://poorlyfundedskynet.azure-devices.net/devices/dexter/messages/events?api-version=2016-11-14 \	    -H "Authorization: SharedAccessSignature sr=poorlyfundedskynet.azure-devices.net%2fdevices%2fdexter&amp;sig=RxxxxxxxtE%3d&amp;se=1555372034" \	    -H "Content-Type: application/json" \	    -d'{"deviceId":"dexter","temperature":70}'		  HTTP/1.1 204 No Content	  Content-Length: 0	  Server: Microsoft-HTTPAPI/2.0	  Date: Sun, 15 Apr 2018 23:54:25 GMT	</code></pre>		<p>You can monitor ingress with <a href="https://github.com/Azure/azure-iot-sdk-csharp/releases/tag/2018-3-13" rel="nofollow noreferrer">Device Explorer</a> or <a href="https://github.com/Azure/iothub-explorer" rel="nofollow noreferrer">iothub-explorer</a>:</p>		<p><a href="https://i.stack.imgur.com/dtHfB.png" rel="nofollow noreferrer"><img src="https://i.stack.imgur.com/dtHfB.png" alt="Device Explorer Monitor"></a></p>		<p>Probably this would work as well: <a href="https://github.com/Azure/azure-iot-cli-extension" rel="nofollow noreferrer">Azure IoT Extension for Azure CLI 2.0</a></p>	"
49847424,86714987,49847981,3,0,Mon Apr 16 05:41:00 EDT 2018,1308777,"Thanks! Using Device Explorer to generate an SAS did the trick. I was using the example python script, and I must have been doing something wrong."
