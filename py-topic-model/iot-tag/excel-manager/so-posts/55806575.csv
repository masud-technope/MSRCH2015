thread_ID, Id, ParentId, PostType, Score, CreationDate, OwnerID, Body
55806575,55806575,null,1,1,Tue Apr 23 07:51:00 EDT 2019,6469642,"<p>I need to process messages from IoT devices and so far I have been fine with my workflow (IoT device sends message to IoT Hub and IoT Hub triggered Azure Function processes the message and saves the information into Azure SQL). But now I have a device which sends the whole information in two separate messages in a row (because of the length of information).	Is there any solution on how to handle these two separate message at once? (Each message type has a unique ID so I would know which message is the first part of the information and which is second)</p>	"
55806575,98297387,55806575,3,0,Tue Apr 23 16:10:00 EDT 2019,8084828,"have a look at the Azure Stream Analytics job for your solution, https://docs.microsoft.com/en-us/azure/stream-analytics/"
55806575,98315449,55806575,3,0,Wed Apr 24 08:05:00 EDT 2019,6469642,"I used to use Stream Analytics but it is much more expensive than Azure Function so I switched to AF and don't want to go back to SA."
55806575,55812566,55806575,2,2,Tue Apr 23 13:38:00 EDT 2019,11228967,"<p>Is it an option to upload it as a file to blob storage assigned to IoT Hub, and by using DeviceClient method UploadBlobAsync? That way you can have azure function <a href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-create-storage-blob-triggered-function" rel="nofollow noreferrer">attached</a> when new file shows up in blob storage container. That could be one way.</p>		<p>If you do not like the file upload solution, you have to consider that Azure functions are stateless, and if you need to merge two messages to get one information on the cloud side, you would need to save the state somewhere and check from there.</p>		<p>Also, reliability here would be also something to consider before deciding if the AF are the right service for stream processing in this particular case. For example: could it be the case that the first message comes, and connection breaks before the second message come to IoT Hub. And can you be sure that messages will always come in order? </p>	"
55806575,98323211,55812566,3,0,Wed Apr 24 11:44:00 EDT 2019,6469642,"Thanks for showing the options. As I wrote above I used to use Stream Analytics for processing messages from IoT Hub but it's much more expensive than Azure Function so I would like to stay in AF. I was thinking that the workflow would be...save the first part to Azure SQL into some kind of temp table and when processing the second part retrieve the first from SQL and then join both parts in AF when the information would be completed finally save it to the final table. 		The matching key would be sequence number from IoT Hub."
55806575,98323564,55812566,3,0,Wed Apr 24 11:54:00 EDT 2019,11228967,"Maybe you can take an advantage of CosmosDB on a similar way, save messages and have AF triggered on CosmosDB entry. In AF you can perform the check if both parts are there, and then proceed. This is more event driven in my opinion."
55806575,98323607,55812566,3,0,Wed Apr 24 11:56:00 EDT 2019,11228967,"Also, CosmosDB can be slightly faster if you handle it properly."
55806575,98323858,55812566,3,0,Wed Apr 24 12:03:00 EDT 2019,6469642,"So in this case there should be two AFs? Because my original AF is IoT hub triggered (handles all messages that arrives on IoT hub) and if I'm right there can't be more triggers."
55806575,98324021,55812566,3,0,Wed Apr 24 12:07:00 EDT 2019,11228967,"Can you please be more specific what do you mean by ' there can't be more triggers'?"
55806575,98324988,55812566,3,0,Wed Apr 24 12:34:00 EDT 2019,6469642,"when I'm creating AF in Visual Studio I can choose from 9 triggers which can start the AF. So I was thinking that I can't combine more of those triggers in one function. Please feel free to correct me if I'm wrong."
55806575,98325227,55812566,3,1,Wed Apr 24 12:41:00 EDT 2019,11228967,"Correct, I suggested having another function to be CosmosDB triggered. This is also a kind of separation of concerns, and delegating different responsibilities to two functions instead of one. Of course, just to outline, scaling and reliability would be also a topic to consider when working on IoT solutions, especially with AFs in this case, but this is not what your question addresses, but please keep this in mind as well."
