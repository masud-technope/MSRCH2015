thread_ID, Id, ParentId, PostType, Score, CreationDate, OwnerID, Body
43773210,43773210,null,1,2,Thu May 04 03:09:00 EDT 2017,7955061,"<p>I'm Trying to make a POST Request to Azure IoT Hub with a JAVA android application, using Volley Library, but I'm getting this error:	BasicNetwork.performRequest: Unexpected response code 400 for <a href="https://elca-iot.azure-devices.net/devices/elca-main-device/messages/events?api-version=2016-02-03" rel="nofollow noreferrer">https://elca-iot.azure-devices.net/devices/elca-main-device/messages/events?api-version=2016-02-03</a>)</p>		<p>To access the IoT Hub I need to use a SAS Key that I need to include in the header of the request. The android application Code is below:</p>		<pre><code>RequestQueue queue = Volley.newRequestQueue(c);	    String url = "https://elca-iot.azure-devices.net/devices/" + deviceId + "/messages/events?api-version=2016-02-03)";	    // Request a string response from the provided URL.	    StringRequest stringRequest = new StringRequest(Request.Method.POST,	            url, new Response.Listener&lt;String&gt;() {	        @Override	        public void onResponse(String response) {	            onPostResponse(response, c, true);	        }	    }, new Response.ErrorListener() {	        @Override	        public void onErrorResponse(VolleyError error) {	            Log.d("Error", error.getMessage());	            onPostResponse(error.getMessage(), c, false);	        }	    }) {	        @Override	        public Map&lt;String, String&gt; getHeaders() throws AuthFailureError {	            Map&lt;String, String&gt; params = new HashMap&lt;String, String&gt;();	            //params.put("Content-Type", "application/xml");	            params.put("Authorization", "[My SAS Key]");	            params.put("Cache-Control", "no-cache");	            return params;	        }	        /*	        @Override	        public Map&lt;String, String&gt; getParams() throws AuthFailureError {	            Map&lt;String, String&gt; params = new HashMap&lt;String, String&gt;();	            params.put("api-version","2016-02-03");	            return params;	        }*/	        @Override	        public String getBodyContentType() {	            return "application/text; charset=UTF-8";	        }	        @Override	        public byte[] getBody(){	            return "On".getBytes();	        }	    };	    try {	        Log.d("request", String.valueOf(stringRequest.getMethod()==Request.Method.POST));	    } catch (Exception authFailureError) {	        authFailureError.printStackTrace();	    }	    // Add the request to the RequestQueue.	    queue.add(stringRequest);	</code></pre>		<p>I've tried to do the same request using POSTMAN and it worked and I don't know why it isn't working with the Android Application. Here's the http code of the request made with POSTMAN:</p>		<pre><code>    POST /devices/elca-main-device/messages/events?api-version=2016-02-03 HTTP/1.1	Host: elca-iot.azure-devices.net	Authorization: [My SAS Key]	Content-Type: application/x-www-form-urlencoded	Cache-Control: no-cache	Postman-Token: d0aa354a-f79c-e574-893a-c259232aa5cb		on	</code></pre>		<p>EDIT:</p>		<p><a href="https://i.stack.imgur.com/QmF6N.png" rel="nofollow noreferrer">Screenshot of POSTMAN</a></p>	"
43773210,74620863,43773210,3,0,Thu May 04 18:21:00 EDT 2017,7955061,"I've tried this, and it doesn't work."
43773210,74659318,43773210,3,0,Fri May 05 16:49:00 EDT 2017,1607191,"what is the error in error listener ? see the error code and share it"
43773210,74588806,43773210,3,0,Thu May 04 04:33:00 EDT 2017,3772041,"You explicitly set the Content-Type to `application/text` while the postman request suggests it should be `application/x-www-form-urlencoded` which is the default for Volley. Check if removing that solves the issue"
43773210,74685026,43773210,3,0,Sat May 06 17:28:00 EDT 2017,7955061,"BasicNetwork.performRequest: Unexpected response code 400"
43773210,74636719,43773210,3,0,Fri May 05 06:52:00 EDT 2017,1607191,"would you please send a screen shot from your post man @MarcosFelipe"
43773210,74653167,43773210,3,0,Fri May 05 14:07:00 EDT 2017,7955061,"There it is @Smartiz"
43773210,79265133,43773210,3,0,Mon Sep 11 08:58:00 EDT 2017,2691443,"@MarcosFelipe Did you solved it??"
43773210,80465967,43773210,3,0,Sun Oct 15 21:46:00 EDT 2017,7955061,"@Noufal yeap. the Akash Agrawal's answer solved it for me."
43773210,43774116,43773210,2,1,Thu May 04 04:50:00 EDT 2017,1607191,"<p>It seems the problem is with <code>body content type</code>	Try adding it both in <code>getHeaders</code> and <code>getBodyContentType</code></p>		<pre><code>        @Override	        public Map&lt;String, String&gt; getHeaders() throws AuthFailureError {	            Map&lt;String, String&gt; params = new HashMap&lt;String, String&gt;();	            //params.put("Content-Type", "application/xml");	            params.put("Authorization", "[My SAS Key]");	            params.put("Cache-Control", "no-cache");	            params.put("Content-Type", "application/x-www-form-urlencoded");	            return params;	        }	        /*	        @Override	        public Map&lt;String, String&gt; getParams() throws AuthFailureError {	            Map&lt;String, String&gt; params = new HashMap&lt;String, String&gt;();	            params.put("api-version","2016-02-03");	            return params;	        }*/	        @Override	        public String getBodyContentType() {	            return "application/x-www-form-urlencoded; charset=UTF-8";	        }	</code></pre>	"
43773210,89332250,43774116,3,0,Wed Jul 04 13:23:00 EDT 2018,null,"still getting error status code 400"
43773210,74622217,43774116,3,0,Thu May 04 19:02:00 EDT 2017,7955061,"Still getting the same error."
43773210,43775081,43773210,2,0,Thu May 04 06:07:00 EDT 2017,4989676,"<p>According to the <a href="https://docs.microsoft.com/en-us/rest/api/iothub/common-error-codes" rel="nofollow noreferrer">Common error codes</a> of Azure IoTHub, the 400 error code means <em><code>"The body of the request is not valid; for example, it cannot be parsed, or the object cannot be validated."</code></em></p>		<p>Meanwhile, as the offical REST reference for <a href="https://docs.microsoft.com/en-us/rest/api/iothub/#common-parameters-and-headers" rel="nofollow noreferrer">Common parameters and headers</a> said, <em><code>"Set the Content-Type header to application/json."</code></em></p>		<p>So please try to change your code as below.</p>		<ol>	<li><p>Add the <code>Content-Type</code> header in the <code>getHeaders</code> method.</p>		<pre><code>params.put("Content-Type", "application/json");	</code></pre></li>	<li><p>Change the reture value of the <code>getBodyContentType</code>method, and use <code>getBytes</code> with <code>UTF-8</code> in the <code>getBody</code> method.</p>		<pre><code>@Override	public String getBodyContentType() {	    return "application/json; charset=UTF-8";	}	@Override	public byte[] getBody(){	    return "On".getBytes("UTF-8");	}	</code></pre></li>	</ol>	"
43773210,89332224,43775081,3,0,Wed Jul 04 13:22:00 EDT 2018,null,"i have some problem :("
43773210,74621056,43775081,3,0,Thu May 04 18:27:00 EDT 2017,7955061,"I've tried this, and I'm getting the same error."
43773210,43936464,43773210,2,2,Fri May 12 11:14:00 EDT 2017,7515888,"<p>It seems the problem lies in the value in the map. [] could not be escaped.</p>		<pre><code>params.put("Authorization", "[My SAS Key]");	</code></pre>		<p>What I did was, while creating the params, I encoded key and value with UTF-8.</p>		<pre><code>params.put("Authorization", URLEncoder.encode("[My SAS Key]", "UTF-8"));	</code></pre>		<p>I also struggled with this problem for 3 days. It may seem like a work around but it worked for me.</p>	"
43773210,89332400,43936464,3,0,Wed Jul 04 13:27:00 EDT 2018,null,"still getting error status code 400"
43773210,74921069,43936464,3,0,Fri May 12 18:20:00 EDT 2017,7955061,"thanks, that worked for me!"
43773210,56803158,43773210,2,0,Fri Jun 28 08:06:00 EDT 2019,3090370,"<p>Android Volley POST request set Content-Type to value "application/json; charset=UTF-8" by default. If you set content type in your request call it will override your content type.	For example if your send request "Content-Type", "application/json" then it will set the content type to "application/json". But if you remove it then automatically it set to "application/json; charset=UTF-8". Problem here is if your back end configured(written by the developers) only to manage "application/json" request then the default call "application/json; charset=UTF-8" would fail your request.(Problem with the back end development). But this will work fine in the POSTMAN. So can't figure out what is actually wrong here. Since you can send a post request by setting "Content-Type" to "application/json" then depend on Volley version your call will fail. Only Volley version 1.1.1 will support override. ('com.android.volley:volley:1.1.1'). So my advice is you have to follow 3 steps.</p>		<ol>	<li>Send your POST request with out content-type and check the response. If it is 400 it is a problem with your back end configuration.</li>	<li>Change your volley version to 'com.android.volley:volley:1.1.1' in your build graddle</li>	<li>Send POST request again as a header like this. 	customHeaders.put("Content-Type","application/json");</li>	</ol>		<p>It should work now.</p>	"
