thread_ID, Id, ParentId, PostType, Score, CreationDate, OwnerID, Body
49026912,49026912,null,1,0,Wed Feb 28 10:11:00 EST 2018,7851279,"<p>I'm trying to get started with google IOT core by posting a simple http request from the command line.</p>		<p>I have set up my registry and device in Console, and added the public key. I set up a telemetry topic. I've generated the JWT using a Qt application I found, using the private key. I'm using the procedure specified at <a href="https://cloud.google.com/iot/docs/how-tos/http-bridge" rel="nofollow noreferrer">https://cloud.google.com/iot/docs/how-tos/http-bridge</a>. My command is:</p>		<p>curl -X POST -H 'authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdWQiOiJzeWx2YW4tam91cm5leS0xOTU4MTUiLCJleHAiOiIxNTIwMzU4NjMyIiwiaWF0IjoiMTUxOTc1MzgzMiJ9.kDkwtWvfAE+AOYT2cObgh8Mux2n1DOuek1KR0YrsFSI=' -H 'content-type: application/json' --data '{"binary_data": "SGVsbG8="}' -H 'cache-control: no-cache' '<a href="https://cloudiotdevice.googleapis.com/v1/projects/sylvan-journey-195815/locations/europe-west1/registries/MyDeviceRegistry/devices/FirstDevice:publishEvent" rel="nofollow noreferrer">https://cloudiotdevice.googleapis.com/v1/projects/sylvan-journey-195815/locations/europe-west1/registries/MyDeviceRegistry/devices/FirstDevice:publishEvent</a>'</p>		<p>When I try to post the command I get error 401 "Request is missing required authentication credential. Expected OAuth 2 access token, login cookie or other valid authentication credential"</p>		<p>I don't know where to look. Is there a problem with my JWT? Is the format of the command wrong? Do I need to add a public key to the registry or just to the devices. How do I find out what's wrong?</p>		<p>Any guidance much appreciated</p>	"
49026912,49037054,49026912,2,0,Wed Feb 28 19:21:00 EST 2018,1552344,"<p>A few ideas:</p>		<ul>	<li>(Update) Check the JWT is valid on <a href="https://jwt.io" rel="nofollow noreferrer">JWT.io</a></li>	<li>Regenerate your EC public / private key and register the device again</li>	<li><strong>Note</strong> the <a href="https://cloud.google.com/iot/docs/how-tos/credentials/jwts#required_claims" rel="nofollow noreferrer">maximum lifetime of a token is 24 hours</a>.</li>	<li>Make sure that your device was registered with the correct credentials, region, and Cloud project.</li>	</ul>		<p>How did you register your device? If the device was registered with a certificate that has expired, you could encounter authentication issues. </p>		<p>The following Python code is how I generate JWTs from the commandline for Curl-testing the HTTP endpoint assuming an RSA256 key:</p>		<pre><code>import datetime	import jwt	import requests		algorithm = 'RS256'	cloud_region = 'your-cloud-region'	device_id = 'your-device-id'	private_key_file = 'path/to/rsa_private.pem'	project_id = 'your-project-id'	registry_id = 'your-registry-id'		token = {	        # The time the token was issued.	        'iat': datetime.datetime.utcnow(),	        # Token expiration time.	        'exp': datetime.datetime.utcnow() + datetime.timedelta(minutes=60),	        # The audience field should always be set to the GCP project id.	        'aud': project_id	}		# Read the private key file.	with open(private_key_file, 'r') as f:	    private_key = f.read()		print(jwt.encode(token, private_key, 	algorithm=algorithm).decode('ascii'))	</code></pre>	"
49026912,85101294,49037054,3,0,Thu Mar 01 11:19:00 EST 2018,7851279,"I registered the device using the console. I've checked the project name / region etc. So, the problem must be with my JWT? I tried pasting it into a web tool at jwt.io and it decoded the claims OK, but still said it was an invalid signature. Is there a web-tool which will allow me to generate JWTs, so I can check everything else is correct?"
49026912,85101273,49037054,3,0,Thu Mar 01 11:19:00 EST 2018,7851279,"I tried removing the =. The JWT should not have expired, expiry date 7 days after creating, but I made a new JWT and tried, all the same."
49026912,90653496,49037054,3,0,Tue Aug 14 21:40:00 EDT 2018,1552344,"Added more suggestions -- I was wrong, the = on the end is valid for the JWT used in authentication. I strongly recommend trying to regenerate a new EC keypair, it appears to me that in some cases the EC keypair is "invalid" (e.g. key used elsewhere?)"
49026912,90371963,49037054,3,0,Mon Aug 06 10:34:00 EDT 2018,3171066,"I have the same issue. How did you fix it? Issue on the JWT? Thanks for your feedback!"
