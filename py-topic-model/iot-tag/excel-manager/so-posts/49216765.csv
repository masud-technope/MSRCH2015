thread_ID, Id, ParentId, PostType, Score, CreationDate, OwnerID, Body
49216765,49216765,null,1,0,Sun Mar 11 04:53:00 EDT 2018,4378837,"<p>To begin with, I'm doing a mini project on the verification of RFID card using NodeMCU. I set up a database and a server to handle all the requests from the client. The problem is, whenever I try to verify a valid card, the function that handles it keeps returning the wrong value.</p>		<p>To be clear, here is my main loop:</p>		<pre class="lang-cpp prettyprint-override"><code>void loop() {	  connectToHost();	  key = kpd.getKey();	  card = readCard();	  delay(200);	  //check for card status	  if(verifyCard(card)){	    Serial.println("Card is valid");	  } else {	    Serial.println("Invalid Card");	  }	  //check connection status	  if(WiFi.status() == WL_CONNECTION_LOST){	    connectToWiFi();	  }	}	</code></pre>		<p>The main loop calls this function:</p>		<pre class="lang-cpp prettyprint-override"><code>boolean verifyCard(String uid){	  String url = "/ECafe/terminal_verify.php?uid=";	  url += uid;	  // This will send the request to the server	  Serial.print("Requesting URL: ");	  Serial.println(url);	  client.print(String("GET ") + url + " HTTP/1.1\r\n" +	    "Host: " + host + "\r\n" +	    "Connection: close\r\n\r\n");	  unsigned long timeout = millis();	  while (client.available() == 0) {	    if (millis() - timeout &gt; 5000) {	      Serial.println("&gt;&gt;&gt; Client Timeout !");	      client.stop();	    }	    yield();	  }	  // Read all the lines of the reply from server and print them to Serial	  while (client.available()) {	    String line = client.readStringUntil('\r');	    //if string contains echo from php file	    if(line.indexOf("Valid")&gt;0){	      return true;	    } else {	      return false;	    }	    yield();	  }	  Serial.println();	  Serial.println("Closing connection");	}	</code></pre>		<p>I intentionally put a valid card UID in the database just to test this function. Yet, it keeps returning false. I'm sure that the response from the server is "Valid". I suspect that the function doesn't even wait for the response from the server and returns a false value because the interval between the GET request is sent and the response is returned is too short. Is that because of the if condition in the main loop? See the attachment for the serial monitor output.</p>		<p><a href="https://i.stack.imgur.com/UTHl3.png" rel="nofollow noreferrer"><img src="https://i.stack.imgur.com/UTHl3.png" alt=""></a></p>	"
49216765,85443294,49216765,3,3,Sun Mar 11 12:12:00 EDT 2018,7059512,"Also asked at: http://forum.arduino.cc/index.php?topic=534412 If you're going to do that then please be considerate enough to add links to the other places you cross posted. This will let us avoid wasting time due to duplicate effort and also help others who have the same questions and find your post to discover all the relevant information."
49216765,85438204,49216765,3,0,Sun Mar 11 05:52:00 EDT 2018,4378837,"Taking out the if condition from while(client.available()) loop seems to fix the problem. But sometime I encounter the Client Timeout loop and hv to reset the module to fix it."
49216765,85438745,49216765,3,0,Sun Mar 11 06:46:00 EDT 2018,5271927,"What should be returned if you get message "Closing connection" at the end of function? There is no return statement."
49216765,85440568,49216765,3,0,Sun Mar 11 09:09:00 EDT 2018,4378837,"That message do nothing. I should remove it before posting it here."
49216765,85440943,49216765,3,0,Sun Mar 11 09:37:00 EDT 2018,5271927,"If you dont call return statement in this execution path, some random value will be returned"
49216765,49268861,49216765,2,0,Wed Mar 14 02:27:00 EDT 2018,1136195,"<p>The logic of your function is flawed.</p>		<pre><code>  // Read all the lines of the reply from server and print them to Serial	  while (client.available()) {	    String line = client.readStringUntil('\r');	    //if string contains echo from php file	    if(line.indexOf("Valid")&gt;0){	      return true;	    } else {	      return false;	</code></pre>		<p>When the code reads the first line, and it doesn't contain <code>Valid</code>, it will fail and return <code>false</code>. So your code will <strong>ALWAYS</strong> return false, as I doubt that the first line returned is <code>Valid</code>...</p>		<pre><code>    }	    yield();	  }	  Serial.println();	  Serial.println("Closing connection");	</code></pre>		<p>The rest of this code is never executed. "Closing connection" is never printed right?</p>	"
