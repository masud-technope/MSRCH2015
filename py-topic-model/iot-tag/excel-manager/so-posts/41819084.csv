thread_ID, Id, ParentId, PostType, Score, CreationDate, OwnerID, Body
41819084,41819084,null,1,1,Tue Jan 24 02:34:00 EST 2017,207240,"<p>I am having a syntax issue with my stream analytics query. Following is my Stream Analytics query, where i am trying to get following fields from the events:</p>		<ul>	<li>Vehicle Id </li>	<li>Diff of previous and current fuel level (for each	vehicle), </li>	<li>Diff of current and previous odometer value (for each	vehicle).</li>	</ul>		<p><strong>NON-WORKING QUERY</strong></p>		<pre><code>SELECT input.vehicleId,	FUEL_DIFF = LAG(input.Payload.FuelLevel) OVER (PARTITION BY vehicleId LIMIT DURATION(minute, 1)) - input.Payload.FuelLevel,	ODO_DIFF = input.Payload.OdometerValue - LAG(input.Payload.OdometerValue) OVER (PARTITION BY input.vehicleId LIMIT DURATION(minute, 1)) 	from input	</code></pre>		<p>Following is one sample input event on which the above query/job is ran on the series of events:</p>		<pre><code>   {	      "IoTDeviceId":"DeviceId_1",	      "MessageId":"03494607-3aaa-4a82-8e2e-149f1261ebbb",	      "Payload":{	         "TimeStamp":"2017-01-23T11:16:02.2019077-08:00",	         "FuelLevel":19.9,	         "OdometerValue":10002	      },	      "Priority":1,	      "Time":"2017-01-23T11:16:02.2019077-08:00",	      "VehicleId":"MyCar_1"	   }	</code></pre>		<p>Following syntax error is thrown when the Stream Analytics job is ran:</p>		<blockquote>	  <p><strong><em>Invalid column name: 'payload'. Column with such name does not exist.</em></strong></p>	</blockquote>		<p>Ironically, the following query works just fine:</p>		<p><strong>WORKING QUERY</strong></p>		<pre><code>SELECT input.vehicleId,	FUEL_DIFF = LAG(input.Payload.FuelLevel) OVER (PARTITION BY vehicleId LIMIT DURATION(second, 1)) - input.Payload.FuelLevel	from input	</code></pre>		<p>The only diffrence between WORKING QUERY and NON-WORKING QUERY is number of LAG constructs used. The NON-WORKING QUERY has two LAG constructs, while WORKING QUERY has just one LAG construct.</p>		<p><em>I have referred  Stream Analytics Query Language, they only have basic examples. Also tried looking into multiple blogs. In addition, I have tried using <strong>GetRecordPropertyValue</strong>() function, but no luck. Kindly suggest.</em></p>		<p><em>Thank you in advance!</em></p>	"
41819084,41822398,41819084,2,0,Tue Jan 24 07:28:00 EST 2017,4573221,"<p>This looks like a syntax bug indeed. Thank you for reporting - we will fix it in the upcoming updates.</p>		<p>Please consider using this query as a workaround:</p>		<pre><code>WITH Step1 AS	(	SELECT vehicleId, Payload.FuelLevel, Payload.OdometerValue	FROM input	)		SELECT vehicleId, 	FUEL_DIFF = LAG(FuelLevel) OVER (PARTITION BY vehicleId LIMIT DURATION(minute, 1)) - FuelLevel,	ODO_DIFF = OdometerValue - LAG(OdometerValue) OVER (PARTITION BY vehicleId LIMIT DURATION(minute, 1)) 	from Step1	</code></pre>	"
