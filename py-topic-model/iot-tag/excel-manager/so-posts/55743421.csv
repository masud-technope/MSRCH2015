thread_ID, Id, ParentId, PostType, Score, CreationDate, OwnerID, Body
55743421,55743421,null,1,0,Thu Apr 18 09:47:00 EDT 2019,5695075,"<p>Headless Pi3, Android Things, running an irrigation app, connecting through wifi to provide a user interface through Nanohttpd. I should mention that the app is only for personal use on my pi - I am not trying to market it or run it anywhere else.</p>		<p>I have previously written about my irrigation app failing once a day or so without pertinent error messages. I have realised that it is because I have been using an unsigned apk for testing purposes, and I have now read that a time limited signature is added in the process. My app dies when it reaches the time limit.</p>		<p>So I have been trying to install a signed version and have failed so far.</p>		<p>I have uploaded a signed version to the Things console, and used this to generate a custom build. When I put the sd card in my pi, the app runs, but I don't get the chance to input the wifi connection details. I have tried to make my app not the default app, in the hopes of seeing the Things toolkit on boot, so I can input the wifi details. I haven't succeeded at that.</p>		<p>I have tried calling this code in my onCreate():</p>		<pre><code>private void connectToWifi() {		        String networkSSID = "***";	        String networkPass = "***";		        WifiConfiguration conf = new WifiConfiguration();	        conf.SSID = "\"" + networkSSID + "\"";   // Please note the quotes. String should contain ssid in quotes	        conf.preSharedKey = "\""+ networkPass +"\"";	        WifiManager wifiManager = (WifiManager)context.getSystemService(Context.WIFI_SERVICE);	        wifiManager.addNetwork(conf);	        //remember id	        int netId = wifiManager.addNetwork(conf);	        wifiManager.disconnect();	        wifiManager.enableNetwork(netId, true);	        wifiManager.reconnect();	    }	</code></pre>		<p>and adding wifi/network permissions to AndroidManifest.xml but the app runs only briefly and I lose the wifi connection.</p>		<p>I have tried installing the signed version through Android Studio, but I get 'Password verification failed'. I have tried Cleaning and rebuilding the project.</p>		<p>I have tried using adb directly: 	adb install C:\AndroidStudioProjects\irrigator\app-release.apk	but I get </p>		<p>'Permission failure: com.google.android.things.permission.USE_PERIPHERAL_IO'</p>		<p>even though I have these permissions in my AndroidManifest.xml:</p>		<pre><code> &lt;uses-permission android:name="android.permission.INTERNET" /&gt;	    &lt;uses-permission android:name="com.google.android.things.permission.USE_PERIPHERAL_IO" /&gt;	    &lt;uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE" /&gt;	</code></pre>		<p>and in the Things Console, I have ticked these permissions in the build process.</p>		<p>I don't know what to try next. Any help much appreciated.</p>		<p>UPDATE: I've tried downloading the signed version I have checked into Android console. Even though in the permissions list shown on the console it says:</p>		<pre><code>android.permission.INTERNET	com.google.android.things.permission.USE_PERIPHERAL_IO	</code></pre>		<p>I still get the error showing in logcat:</p>		<pre><code> java.lang.SecurityException: Caller lacks required permission com.google.android.things.permission.USE_PERIPHERAL_IO	</code></pre>		<p>?</p>	"
55743421,55747290,55743421,2,0,Thu Apr 18 13:39:00 EDT 2019,5695075,"<p>adb install -r -g C:\1\app-release.apk</p>		<p>does the trick. I'd missed out the g flag. g grants all permissions.</p>	"
