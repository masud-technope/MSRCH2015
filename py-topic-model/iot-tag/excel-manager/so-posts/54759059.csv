thread_ID, Id, ParentId, PostType, Score, CreationDate, OwnerID, Body
54759059,54759059,null,1,0,Tue Feb 19 04:52:00 EST 2019,309699,"<p>I've been trying to make a direct method call using the AMQP protocol. But can't make it work. I believe calling direct method is possible over AMQP if I'm not wrong. It works with MQTT though. Any clues would be much appreciated.</p>		<p>Here's the code:</p>		<pre><code>using Microsoft.Azure.Devices.Client;	using Microsoft.Azure.Devices.Shared;	using Newtonsoft.Json;	using System;	using System.Text;	using System.Threading;	using System.Threading.Tasks;		namespace VirtualIoTDevice	{	    internal class Program	    {	        private const string DeviceConnectionString = "device-connection-string";	        private const string DEVICE_ID = "device01";	        private static DeviceClient _device;		        private static async Task Main(string[] args)	        {	            Console.WriteLine("Initializing virtual IoT device..");	            using (_device = DeviceClient.CreateFromConnectionString(DeviceConnectionString, DEVICE_ID))	            {	                await _device.OpenAsync();	                await _device.SetMethodHandlerAsync("showMessage", ShowMessage, null);		                Console.ReadKey();	            }	        }		        private static Task&lt;MethodResponse&gt; ShowMessage(MethodRequest methodRequest, object userContext)	        {	            Console.WriteLine("***Direct message received***");	            Console.WriteLine(methodRequest.DataAsJson);		            var responsePayload = Encoding.ASCII.GetBytes(JsonConvert.SerializeObject(new { response = "Message shown!" }));	            return Task.FromResult(new MethodResponse(responsePayload, 200));	        }	    }	}	</code></pre>		<p>And here's the command to invoke the direct method:</p>		<pre><code>az iot hub invoke-device-method -n "iothub-name" -d "device01" --method-name "showMessage"	</code></pre>	"
54759059,96303965,54759059,3,0,Tue Feb 19 08:28:00 EST 2019,7534341,"Are you using Microsoft.Azure.Devices.Client version 1.19.0 ?  If not, try upgrading.  The versions prior to that had some bugs that might be causing your problems."
54759059,96307987,54759059,3,0,Tue Feb 19 10:20:00 EST 2019,1537195,"what is the error you are getting? And yes, Direct Methods should also over AMQP"
54759059,54770276,54759059,2,2,Tue Feb 19 15:55:00 EST 2019,1537195,"<p>Ok, I know what your issue is: In the latest version of the SDK there was some change in regards to blocking threads. I don't know if this was an intended change or a regression. </p>		<p>However, in your case the <code>Console.ReadKey()</code> is somehow blocking AMQP from connecting in the first place. MQTT is not affected by this - which could indicate it might be a regression.</p>		<p>So, if you change <code>Console.ReadKey()</code> to for example <code>await Task.Delay(-1)</code> it works again in my test.</p>	"
54759059,96343190,54770276,3,1,Wed Feb 20 08:56:00 EST 2019,1537195,"I opened a Github issue for the team to investigate https://github.com/Azure/azure-iot-sdk-csharp/issues/807"
54759059,96333526,54770276,3,0,Wed Feb 20 00:22:00 EST 2019,309699,"Thanks. 'await Task.Delay(-1)' works perfectly. I'm using Microsoft.Azure.Devices.Client version 1.19.0. Couldn't find anything related to blocking calls in the release notes. If you could point me to some docs, that'd be great."
