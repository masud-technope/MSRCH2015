thread_ID, Id, ParentId, PostType, Score, CreationDate, OwnerID, Body
52865956,52865956,null,1,3,Thu Oct 18 02:10:00 EDT 2018,5336658,"<p>I'm plan to generate new thing in AWS IoT Registry and once the thing is generated successfully, write the thing arn, thing name, cert information into AWS RDS database.</p>		<p>Is this possible to use lambda capture IoT registry event and trigger lambda to write into database? </p>		<p>Any suggestion?</p>	"
52865956,52869580,52865956,2,4,Thu Oct 18 08:06:00 EDT 2018,2531132,"<p>AWS IoT publishes a lot of its events through it's own MQTT broker.</p>		<p>In your case you're interested in the <code>$aws/events/thing/&lt;thingName&gt;/created</code> topic (<a href="https://docs.aws.amazon.com/iot/latest/developerguide/registry-events.html" rel="nofollow noreferrer">https://docs.aws.amazon.com/iot/latest/developerguide/registry-events.html</a>).</p>		<p>When messages are sent through certain topics you can use the AWS IoT Rule engine to automatically perform actions (<a href="https://docs.aws.amazon.com/iot/latest/developerguide/iot-rules.html" rel="nofollow noreferrer">https://docs.aws.amazon.com/iot/latest/developerguide/iot-rules.html</a>).</p>		<p>These actions <em>could</em> be a lambda (if you have more logic outside what you've shared in the question), but there's a dynamodb rule, too, which can be used to solve this problem without writing your own custom code:</p>		<ul>	<li>DynamoDb rules: <a href="https://docs.aws.amazon.com/iot/latest/developerguide/iot-rule-actions.html#dynamodb-v2-rule" rel="nofollow noreferrer">https://docs.aws.amazon.com/iot/latest/developerguide/iot-rule-actions.html#dynamodb-v2-rule</a></li>	<li>Lambda rules: <a href="https://docs.aws.amazon.com/iot/latest/developerguide/iot-rule-actions.html#lambda-rule" rel="nofollow noreferrer">https://docs.aws.amazon.com/iot/latest/developerguide/iot-rule-actions.html#lambda-rule</a></li>	</ul>		<p>So in your case, you might do something like this:</p>		<pre><code>{	  "sql": "SELECT thingId thingName timestamp FROM '$aws/events/thing/+/created'",	  "ruleDisabled": false,	  "awsIotSqlVersion": "2016-03-23",	  "actions": [{	    "dynamoDBv2": {	       "roleArn": "arn:aws:iam::123456789012:role/aws_iot_dynamoDBv2", 	       "putItem": {	         "tableName": "my_ddb_table"	        }	     }	  }]	}	</code></pre>		<p>Unfortunately it seems like AWS does not publish the certificate information to a topic on registration. My guess is this is because there isn't a 1-to-1 relationship between certificate and device.</p>		<p>You <em>can</em> get this information by listening to the <code>$aws/events/presence/connected/clientId</code> topic; enforcing that the <code>clientId === thingId</code> (which is typically the case), and recording the <code>principalIdentifier</code> from the message (<a href="https://docs.aws.amazon.com/iot/latest/developerguide/life-cycle-events.html#connect-disconnect" rel="nofollow noreferrer">https://docs.aws.amazon.com/iot/latest/developerguide/life-cycle-events.html#connect-disconnect</a>). You can once again automate this using AWS IoT rules.</p>	"
